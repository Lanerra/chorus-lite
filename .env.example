# Chorus Environment Variables
#
# Copy this file to .env and fill in the values.
#

# -- Database Configuration --
# PostgreSQL settings for the Canon
POSTGRES_USER=chorus
POSTGRES_PASSWORD=chorus_password
POSTGRES_DB=chorus_canon
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# Deprecated: Postgres-backed memory removed. Chorus uses in-memory store only.
# MEMORY_DB_URL is ignored.
# MEMORY_DB_URL="postgresql://chorus:chorus_password@localhost:5432/chorus_memory"

# -- LLM Provider Configuration --
# Example for a local OpenAI-compatible server
# See LiteLLM docs for more providers: https://docs.litellm.ai/docs/providers
OPENAI_API_BASE="http://localhost:1234/v1"
OPENAI_API_KEY="sk-1234"
# Global sampling temperature for all LLM calls; callers can override per-call
TEMPERATURE=0.7

# -- Embedding Model Configuration --
# Required for generating scene embeddings.
# Can be a local model via LiteLLM or a provider like OpenAI.
EMBEDDING_MODEL="ollama/nomic-embed-text:latest"
# Optional: override the API base and key for embeddings.
# Defaults to OPENAI_API_BASE and OPENAI_API_KEY if unset.
EMBEDDING_API_BASE="http://localhost:11434"
EMBEDDING_API_KEY=""

# -- Agent Model Selection --
# Point these to the model names available on your LLM server
MAESTRO_MODEL="mistralai/Mixtral-8x7B-Instruct-v0.1"
ARCHITECT_MODEL="mistralai/Mixtral-8x7B-Instruct-v0.1"
CHARACTER_ARCHITECT_MODEL="mistralai/Mixtral-8x7B-Instruct-v0.1"
LOREKEEPER_MODEL="mistralai/Mixtral-8x7B-Instruct-v0.1"
# Drafts scenes for the worker loop
SCENE_WRITER_MODEL="mistralai/Mixtral-8x7B-Instruct-v0.1"
# Single-pass coherence validation (replaces continuity and style agents)
COHERENCE_CHECKER_MODEL="mistralai/Mixtral-8x7B-Instruct-v0.1"
# Applies feedback from the reviewer loop
INTEGRATION_MODEL="mistralai/Mixtral-8x7B-Instruct-v0.1"

# -- System Configuration --
LOG_LEVEL=INFO
# Path for application logs
CHORUS_LOG_FILE=./chorus_log.txt
SURPRISE_ME=False
# Web server port
PORT=8000
# Disable token auth for the web UI
CHORUS_DISABLE_AUTH=False
# Web interface token for authentication
CHORUS_WEB_TOKEN=changeme
# Coherence check configuration
COHERENCE_MIN_WORD_COUNT=100
COHERENCE_MIN_PARAGRAPHS=2
COHERENCE_CHARACTER_CHECK=True
COHERENCE_DIALOGUE_CHECK=True
COHERENCE_STRUCTURE_CHECK=True
# Bypass coherence check for testing only (accepted truthy values: 1, true, yes)
CHORUS_DISABLE_COHERENCE_CHECK=False

# -- Graph Weaver Configuration --


# Maximum revision cycles before exiting the loop
REVISION_LIMIT=3
# Maximum graph super-steps before raising GraphRecursionError
RECURSION_LIMIT=100

# Timeout for dual-write operations (seconds)
DUAL_WRITE_TIMEOUT=60

# -- Cache Configuration --
# Cache TTL for world generation operations (seconds)
CACHE_TTL_WORLD_GEN=3600
# Cache TTL for expensive operations (seconds)
CACHE_TTL_EXPENSIVE=1800

# -- Retry Configuration --
# Number of retry attempts for side-effectful nodes
RETRY_ATTEMPTS=3
# Initial retry backoff in seconds
RETRY_BACKOFF=0.5
# Maximum retry interval in seconds
RETRY_MAX_INTERVAL=60

# -- Ingestion Configuration --
# Maximum characters processed per batch
INGEST_CHUNK_SIZE=10000
# Model used to segment long files
INGEST_SEGMENT_MODEL="mistralai/Mixtral-8x7B-Instruct-v0.1"

# -- Worker Configuration --
# Seconds the worker sleeps when idle
WORKER_IDLE=0.1
# Optional identifier for worker processes
WORKER_ID=""
# JSON mapping of custom handlers
WORKER_HANDLERS=""
# Number of task retries before giving up
MAX_TASK_RETRIES=3
# Retries for individual handlers
HANDLER_RETRIES=3

# -- Snapshot Configuration --
# Seconds between Canon snapshots
SNAPSHOT_INTERVAL=3600

# -- Miscellaneous Configuration --
# Provide a starting idea for non-interactive runs
INITIAL_IDEA=""
# Enable surprise mode in Maestro
SURPRISE_ME=False
# Weaver mode (standard, etc.)
WEAVER_MODE=standard
# Memory limit for operations
MEMORY_LIMIT=10
# LangGraph checkpointer database URL (deprecated, use CHECKPOINT_DB_URL)
CHECKPOINT_DB_URL=""

# -- Enhanced Checkpoint Configuration --
# PostgreSQL connection URL for distributed checkpointing
CHECKPOINT_DB_URL=""
# Enable compression for checkpoint data
CHECKPOINT_COMPRESSION=True
# Batch size for checkpoint operations
CHECKPOINT_BATCH_SIZE=10
# Timeout for batch processing in seconds
CHECKPOINT_BATCH_TIMEOUT=5.0
# Heartbeat interval for distributed locks in seconds
CHECKPOINT_HEARTBEAT_INTERVAL=15.0
# Lock TTL (time-to-live) in seconds
CHECKPOINT_LOCK_TTL=300.0
# Cleanup interval for old checkpoints in seconds
CHECKPOINT_CLEANUP_INTERVAL=1800
# Minimum connections in the connection pool
CHECKPOINT_POOL_MIN_CONNECTIONS=5
# Maximum connections in the connection pool
CHECKPOINT_POOL_MAX_CONNECTIONS=20
# Deployment type (development, testing, production, high_throughput)
CHECKPOINT_DEPLOYMENT_TYPE=production

# -- Concurrency Configuration --
# Maximum number of concurrent scene processing tasks (default: 5 for 90% improvement)
SCENE_CONCURRENCY=5
# Number of parallel queue workers (default: 3 for 5x throughput)
QUEUE_WORKERS=3
# Scene processing timeout in seconds
SCENE_TIMEOUT=300
# Circuit breaker failure threshold
CIRCUIT_BREAKER_THRESHOLD=5
# Circuit breaker reset timeout in seconds
CIRCUIT_BREAKER_TIMEOUT=60
